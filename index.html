<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lilicord</title>
    <style>
        :root {
            --dark: #36393f;
            --darker: #2f3136;
            --darkest: #202225;
            --light: #dcddde;
            --lighter: #ffffff;
            --primary: #5865f2;
            --success: #3ba55c;
            --lilicord: #9b59b6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Whitney', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        body {
            display: flex;
            height: 100vh;
            background-color: var(--dark);
            color: var(--light);
            overflow: hidden;
        }

        .servers {
            width: 72px;
            background-color: var(--darkest);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 12px;
            overflow-y: auto;
        }

        .server-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--darker);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--light);
            font-weight: bold;
        }

        .server-icon:hover {
            border-radius: 16px;
            background-color: var(--lilicord);
        }

        .server-icon.active {
            border-radius: 16px;
            background-color: var(--lilicord);
        }

        .server-icon.add {
            background-color: var(--darker);
            color: var(--success);
        }

        .server-icon.add:hover {
            background-color: var(--success);
            color: white;
        }

        .channels {
            width: 240px;
            background-color: var(--darker);
            display: flex;
            flex-direction: column;
        }

        .channels-header {
            padding: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.2);
            font-weight: bold;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2);
            color: var(--light);
        }

        .channel-category {
            padding: 16px 8px 0 16px;
            color: #8e9297;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .channel {
            padding: 8px 8px 8px 16px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            cursor: pointer;
            margin: 0 8px;
            font-size: 15px;
        }

        .channel:hover {
            background-color: rgba(79, 84, 92, 0.4);
        }

        .channel.active {
            background-color: rgba(79, 84, 92, 0.6);
        }

        .channel .hash {
            margin-right: 6px;
            color: #8e9297;
            font-weight: bold;
        }

        .chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--dark);
        }

        .chat-header {
            padding: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.2);
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
        }

        .chat-header .hash {
            color: #8e9297;
            margin-right: 8px;
            font-weight: bold;
        }

        .chat-header .channel-name {
            font-weight: 600;
        }

        .messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            display: flex;
            margin-bottom: 16px;
            padding: 2px 0;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--lilicord);
            margin-right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        .message-content {
            flex: 1;
            min-width: 0;
        }

        .message-header {
            display: flex;
            align-items: baseline;
            margin-bottom: 4px;
        }

        .message-username {
            font-weight: 600;
            margin-right: 8px;
            color: var(--light);
        }

        .message-time {
            color: #8e9297;
            font-size: 12px;
        }

        .message-text {
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message-input-container {
            padding: 16px;
            background-color: var(--darker);
        }

        .message-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background-color: var(--darkest);
            color: var(--light);
            font-size: 15px;
            outline: none;
        }

        .message-input:focus {
            box-shadow: 0 0 0 2px var(--lilicord);
        }

        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100vh;
            background-color: var(--dark);
        }

        .login-box {
            background-color: var(--darker);
            padding: 32px;
            border-radius: 8px;
            width: 480px;
            box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .login-title {
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 600;
            color: var(--light);
        }

        .login-subtitle {
            margin-bottom: 20px;
            color: #b9bbbe;
        }

        .login-button {
            background-color: var(--lilicord);
            color: white;
            border: none;
            padding: 12px;
            width: 100%;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .login-button:hover {
            background-color: #8e44ad;
        }

        .hidden {
            display: none !important;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #202225;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #2f3136;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <h1 class="login-title">Bem-vindo ao Lilicord</h1>
            <p class="login-subtitle">Entre para começar a conversar</p>
            <button id="google-login" class="login-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12.545 10.239v3.821h5.445c-0.712 2.315-2.647 3.972-5.445 3.972-3.332 0-6.033-2.701-6.033-6.032s2.701-6.032 6.033-6.032c1.498 0 2.866 0.549 3.921 1.453l2.814-2.814c-1.784-1.664-4.13-2.676-6.735-2.676-5.522 0-10 4.479-10 10s4.478 10 10 10c8.396 0 10-7.524 10-10 0-0.668-0.068-1.293-0.182-1.891h-9.818z"></path>
                </svg>
                Entrar com Google
            </button>
            <div id="g_id_onload"
                data-client_id="380915385724-f4fl98kfa668bmokst5o0ga0idhjkfct.apps.googleusercontent.com"
                data-callback="handleGoogleLogin"
                data-auto_prompt="false">
            </div>
        </div>
    </div>

    <div id="app" class="hidden">
        <div class="servers">
            <div class="server-icon active" style="background-color: var(--lilicord);">LC</div>
            <div class="server-icon">1</div>
            <div class="server-icon">2</div>
            <div class="server-icon add">+</div>
        </div>

        <div class="channels">
            <div class="channels-header">LILICORD</div>
            <div class="channel-category">Canais de Texto</div>
            <div class="channel active" data-channel="geral">
                <span class="hash">#</span>
                geral
            </div>
            <div class="channel" data-channel="jogos">
                <span class="hash">#</span>
                jogos
            </div>
            <div class="channel" data-channel="musica">
                <span class="hash">#</span>
                música
            </div>
        </div>

        <div class="chat">
            <div class="chat-header">
                <span class="hash">#</span>
                <span class="channel-name" id="current-channel">geral</span>
            </div>

            <div class="messages" id="messages-container">
                <div class="message">
                    <div class="message-avatar">LC</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-username">Lilicord</span>
                            <span class="message-time">Agora</span>
                        </div>
                        <div class="message-text">
                            Conectando ao servidor...
                        </div>
                    </div>
                </div>
            </div>

            <div class="message-input-container">
                <input type="text" class="message-input" id="message-input" placeholder="Enviar uma mensagem para #geral" autocomplete="off" disabled>
            </div>
        </div>
    </div>

    <script>
        // Configurações REAIS
        const CONFIG = {
            MONGODB_URI: 'mongodb+srv://joaopsb12223:MEdc0E2SSO2nH4sc@lilicord.cek8ark.mongodb.net/Lilicord?retryWrites=true&w=majority',
            API_URL: 'https://api.lilicord.com',
            GOOGLE_CLIENT_ID: '380915385724-f4fl98kfa668bmokst5o0ga0idhjkfct.apps.googleusercontent.com'
        };

        // Aplicação Principal
        class Lilicord {
            constructor() {
                this.user = null;
                this.currentChannel = 'geral';
                this.socket = null;
                this.init();
            }

            async init() {
                this.setupEventListeners();
                this.loadGoogleAPI();
                await this.checkAuth();
            }

            async checkAuth() {
                const token = localStorage.getItem('lilicord_token');
                if (token) {
                    try {
                        const user = await this.fetchUser(token);
                        this.user = user;
                        this.showApp();
                        this.connectSocket();
                    } catch (error) {
                        console.error('Erro de autenticação:', error);
                        localStorage.removeItem('lilicord_token');
                    }
                }
            }

            async fetchUser(token) {
                const response = await fetch(`${CONFIG.API_URL}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                return await response.json();
            }

            showApp() {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                document.getElementById('message-input').disabled = false;
                this.loadMessages();
            }

            async loadMessages() {
                try {
                    const response = await fetch(`${CONFIG.API_URL}/messages?channel=${this.currentChannel}`, {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('lilicord_token')}`
                        }
                    });
                    const messages = await response.json();
                    this.renderMessages(messages);
                } catch (error) {
                    console.error('Erro ao carregar mensagens:', error);
                }
            }

            renderMessages(messages) {
                const container = document.getElementById('messages-container');
                
                if (!messages || messages.length === 0) {
                    container.innerHTML = `
                        <div class="message">
                            <div class="message-avatar">LC</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-username">Lilicord</span>
                                    <span class="message-time">Agora</span>
                                </div>
                                <div class="message-text">
                                    Nenhuma mensagem neste canal ainda.
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = messages.map(msg => `
                    <div class="message">
                        <div class="message-avatar" style="background-color: ${this.getUserColor(msg.user.name)}">
                            ${msg.user.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-username">${msg.user.name}</span>
                                <span class="message-time">${new Date(msg.timestamp).toLocaleTimeString()}</span>
                            </div>
                            <div class="message-text">${msg.text}</div>
                        </div>
                    </div>
                `).join('');

                container.scrollTop = container.scrollHeight;
            }

            async sendMessage(text) {
                if (!text.trim()) return;

                try {
                    await fetch(`${CONFIG.API_URL}/messages`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('lilicord_token')}`
                        },
                        body: JSON.stringify({
                            channel: this.currentChannel,
                            text: text
                        })
                    });
                } catch (error) {
                    console.error('Erro ao enviar mensagem:', error);
                }
            }

            changeChannel(channel) {
                this.currentChannel = channel;
                document.getElementById('current-channel').textContent = channel;
                document.querySelectorAll('.channel').forEach(el => {
                    el.classList.toggle('active', el.dataset.channel === channel);
                });
                document.getElementById('message-input').placeholder = `Enviar uma mensagem para #${channel}`;
                this.loadMessages();
            }

            connectSocket() {
                this.socket = new WebSocket(`wss://api.lilicord.com/socket?token=${localStorage.getItem('lilicord_token')}`);

                this.socket.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    if (data.type === 'new_message' && data.message.channel === this.currentChannel) {
                        this.loadMessages();
                    }
                };
            }

            getUserColor(name) {
                let hash = 0;
                for (let i = 0; i < name.length; i++) {
                    hash = name.charCodeAt(i) + ((hash << 5) - hash);
                }
                const hue = Math.abs(hash % 360);
                return `hsl(${hue}, 70%, 60%)`;
            }

            setupEventListeners() {
                document.getElementById('message-input').addEventListener('keypress', async (e) => {
                    if (e.key === 'Enter' && e.target.value.trim()) {
                        await this.sendMessage(e.target.value);
                        e.target.value = '';
                    }
                });

                document.querySelectorAll('.channel').forEach(channel => {
                    channel.addEventListener('click', () => {
                        this.changeChannel(channel.dataset.channel);
                    });
                });

                document.getElementById('google-login').addEventListener('click', () => {
                    google.accounts.id.prompt();
                });
            }

            loadGoogleAPI() {
                const script = document.createElement('script');
                script.src = 'https://accounts.google.com/gsi/client';
                script.async = true;
                script.defer = true;
                document.body.appendChild(script);
            }

            async handleGoogleLogin(response) {
                document.getElementById('google-login').innerHTML = '<div class="loading"></div>';

                try {
                    const authResponse = await fetch(`${CONFIG.API_URL}/auth/google`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            token: response.credential
                        })
                    });

                    const data = await authResponse.json();
                    
                    if (data.token) {
                        localStorage.setItem('lilicord_token', data.token);
                        this.user = data.user;
                        this.showApp();
                        this.connectSocket();
                    }
                } catch (error) {
                    console.error('Erro no login:', error);
                    document.getElementById('google-login').innerHTML = 'Erro - Tente novamente';
                    setTimeout(() => {
                        document.getElementById('google-login').innerHTML = 'Entrar com Google';
                    }, 2000);
                }
            }
        }

        // Inicializa a aplicação
        const app = new Lilicord();

        // Função global para o Google Login
        window.handleGoogleLogin = (response) => app.handleGoogleLogin(response);
    </script>
</body>
                </html>
